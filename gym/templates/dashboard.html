<!DOCTYPE html>
<html>
<head>
  <title>Dashboard</title>
  <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
</head>
<body>

<h2>Gym Dashboard</h2>
<a href="/add">Add Member</a>

<table border="1" cellpadding="10">
<tr>
  <th>ID</th><th>Name</th><th>Phone</th><th>End</th><th>Status</th><th>QR</th>
</tr>

{% for m in members %}
<tr>
  <td>{{ m.member_id }}</td>
  <td>{{ m.name }}</td>
  <td>{{ m.phone }}</td>
  <td>{{ m.end_date }}</td>

  {% if m.end_date >= now().strftime("%Y-%m-%d") %}
    <td>Active</td>
  {% else %}
    <td>Expired</td>
  {% endif %}

  <td>
    <a href="{{ url_for('generate_qr', member_id=m.member_id) }}" target="_blank">
      View QR
    </a>
  </td>
</tr>
{% endfor %}
</table>

<h3>Attendance (Last 7 Days)</h3>
<canvas id="chart"></canvas>

<script>
new Chart(document.getElementById("chart"), {
  type: "line",
  data: {
    labels: {{ chart_dates | safe }},
    datasets: [{
      data: {{ chart_counts | safe }},
      borderColor: "blue",
      fill: false
    }]
  }
});
</script>

</body>
</html>
